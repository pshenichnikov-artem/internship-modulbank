# AccountService — Сервис управления банковскими счетами и транзакциями

---

## Описание проекта

**AccountService** — микросервис для управления банковскими счетами и транзакциями. Предоставляет API для создания, обновления, удаления счетов и управления транзакциями.

---

## Технологии

- .NET 9 / ASP.NET Core  
- Entity Framework Core (EF Core)  
- MediatR
- FluentValidation  
- AutoMapper  
- Swagger/OpenAPI  
- In-memory Cache  

---

## Архитектура

- **Features** — бизнес-логика по функциональным модулям (Accounts, Transactions)  
- **Common** — общие модели, интерфейсы, утилиты  
- **Infrastructure** — взаимодействие с базой данных и внешними системами  

---

## Основная функциональность

### Управление счетами

- Создание счетов разных типов: кредитный, депозитный, расчетный  
- Получение информации о счетах с фильтрацией, пагинацией и сортировкой  
- Обновление и частичное изменение параметров счета  
- Закрытие и удаление счетов

### Управление транзакциями

- Создание транзакций: пополнение (Credit), списание (Debit), перевод (Transfer)  
- Отмена транзакций с проверкой балансов и целостности данных  
- Получение истории транзакций с фильтрацией и пагинацией  
- Обновление описаний транзакций  

---

## Бизнес-правила и ограничения

- **Переводы (Transfer) с депозитного счета запрещены.**  
- **Депозитный и расчетный счета не могут иметь отрицательный баланс.**  
- **Кредитный счет допускает уход в минус.**  
- При переводах деньги списываются с контрагента (`CounterpartyAccountId`) и зачисляются на основной счет (`AccountId`).  
- Владелец операции должен совпадать с владельцем счета, с которого списываются средства (для переводов — контрагент(ownerId всегда подставляется одинаковый на данный момент)).  
- Валюты конвертируются при необходимости, однако текущая реализация содержит жестко заданный (захардкоженный) механизм конвертации между валютами.  

---

## Описание процесса транзакций

- Каждая транзакция запускается в рамках транзакции базы данных для обеспечения атомарности.  
- Перед проведением операции проверяется принадлежность счетов пользователю по `OwnerId`.  
- Валидируется поддержка валют транзакции и счетов.  
- Для операций пополнения/списания изменяется баланс одного счета, с учетом бизнес-правил.  
- Для переводов изменяются балансы двух счетов с учетом конвертации валют.  
- При ошибках изменения откатываются.  
- Отмена транзакций восстанавливает балансы с обратной логикой, помечая транзакцию как отменённую.  

---

## Запуск проекта

1. Клонировать репозиторий и перейти в каталог проекта.
```bash
https://github.com/pshenichnikov-artem/internship-modulbank.git
cd AccountService
```
2. Запустить проект командой `dotnet run` или из IDE.  

---

## API Endpoints (Кратко)

### Счета (Accounts)

| Метод  | URL                                 | Описание                 |
| ------ | ----------------------------------- | ------------------------ |
| GET    | `/api/v1/accounts`                  | Получить список счетов   |
| GET    | `/api/v1/accounts/{id}`             | Получить счет по ID      |
| POST   | `/api/v1/accounts`                  | Создать новый счет       |
| PUT    | `/api/v1/accounts/{id}`             | Обновить счет полностью  |
| PATCH  | `/api/v1/accounts/{id}/{fieldName}` | Обновить отдельное поле  |
| DELETE | `/api/v1/accounts/{id}`             | Удалить или закрыть счет |


### Транзакции (Transactions)

| Метод | URL                                | Описание                       |
| ----- | ---------------------------------- | ------------------------------ |
| POST  | `/api/v1/transactions/search`      | Поиск транзакций с фильтрацией |
| GET   | `/api/v1/transactions/{id}`        | Получить транзакцию по ID      |
| POST  | `/api/v1/transactions`             | Создать новую транзакцию       |
| PUT   | `/api/v1/transactions/{id}`        | Обновить описание транзакции   |
| POST  | `/api/v1/transactions/{id}/cancel` | Отменить транзакцию            |


---

## Важные замечания

- Правила списания и зачисления строго зависят от типа счета и транзакции.  
- Переводы с депозитного счета запрещены.  
- Поддержка мультивалютности есть, но конвертация валют реализована статично и требует доработки для реальной работы с курсами.  

---