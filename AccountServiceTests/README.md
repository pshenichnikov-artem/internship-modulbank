# AccountServiceTests

Набор тестов для проверки функциональности AccountService.

---

## Структура тестов

### Unit Tests

**AccountServiceUnitTests** — модульные тесты для проверки изменения валюты у счета  
**DeleteAccountHandlerTests** - модульные тесты дял проверки удаления аккаунта  
**TransactionServiceTests** - модульные тесты для проверки создания и отмены транзакций  

### Integration Tests

**ParallelTransferTests** — интеграционные тесты для проверки потокобезопасности и параллельного выполнения операций.

- Используется реальная база данных PostgreSQL, запущенная в тестовом Docker-контейнере.  
- JWT-аутентификация мокнута, Keycloak не требуется.

Основные тесты:

- **ParallelTransfers_ShouldPreserveTotalBalance**  
  Одновременное выполнение 50 переводов между двумя счетами с проверкой того, что общая сумма балансов не изменилась. Проверяется корректная работа механизмов блокировки и обработка конфликтов параллелизма.

- **CancelTransactions_Parallel_CorrectBalances**  
  Одновременное выполнение отмены 50 транзакций разных типов (пополнение, списание, перевод) и проверка, что балансы счетов остаются корректными (не становятся отрицательными) и общая сумма балансов сохраняется. Тест проверяет корректность отката операций и целостность данных при параллельной отмене транзакций.


---

## Технологии

- **XUnit** — фреймворк для тестирования
- **Microsoft.EntityFrameworkCore.InMemory** — база данных в памяти для тестов
- **Moq** — библиотека для создания mock-объектов
- **Microsoft.Extensions.Logging** — логирование в тестах
- **Testcontainers.PostgreSql** — запуск PostgreSQL в Docker-контейнере для интеграционных тестов